<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil de Usuario - PetMe</title>
  <link rel="icon" href="/Img/icono pet me.png" type="image/x-icon" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;900&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <link rel="stylesheet" href="/CSS/navbar.css" />
  <link rel="stylesheet" href="/CSS/variables.css" />
  <link rel="stylesheet" href="/CSS/perfil.css" />
  <link rel="stylesheet" href="/CSS/notificaciones.css" />
  <link rel="stylesheet" href="/CSS/chat.css">
</head>

<body>
  <nav class="navbar navbar-dark bg-petme fixed-top">
    <div class="container-fluid d-flex align-items-center">
      <a class="navbar-brand d-flex align-items-center" href="/componentes/acercaDeNosotros.html">
        <img src="/Img/icono pet me.png" alt="Logo" class="me-3" style="height: 60px" />
      </a>

      <ul class="navbar-nav d-flex flex-row gap-4 me-auto d-none d-lg-flex">
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" href="/componentes/contacto.html">
            <i class="bi bi-envelope"></i> Cont치ctanos
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" href="/componentes/acercaDeNosotros.html">
            <i class="bi bi-info-circle"></i> Acerca de Nosotros
          </a>
        </li>
      </ul>


      <div class="d-flex align-items-center d-none d-lg-flex gap-3">
        <a class="nav-link" href="/componentes/feed.html">
          <i class="bi bi-house-door" style="font-size: 1.5rem; color: white"></i>
        </a>
        <a href="#" class="nav-link position-relative" data-bs-toggle="modal" data-bs-target="#notificacionesModal">
          <i class="bi bi-bell" style="font-size: 1.5rem;"></i>

          <span id="badge-notificaciones"
            class="position-absolute top-0 start-100 translate-middle bg-danger border border-light rounded-circle d-none"
            style="padding: 5px;">
            <span class="visually-hidden">Nuevas notificaciones</span>
          </span>
        </a>
        <a class="nav-link" href="/componentes/perfil.html">
          <i class="bi bi-person-circle" style="font-size: 1.5rem; color: white"></i>
        </a>
      </div>

      <div class="d-flex align-items-center d-lg-none">
        <div class="search-container me-3">
          <div class="input-group" style="max-width: 150px">
            <input type="search" class="form-control search-input" placeholder="Search" aria-label="Search" />
            <button class="btn search-btn" type="submit">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </nav>

  <div class="offcanvas offcanvas-end bg-petme" tabindex="-1" id="offcanvasDarkNavbar">
    <div class="offcanvas-header">
      <img id="offcanvas-logo" src="/Img/pet me.png" alt="Logo" class="me-3" style="height: 25px" />
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2" href="/componentes/feed.html">
            <i class="bi bi-house-door"></i> Inicio
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2" data-bs-toggle="modal"
            data-bs-target="#notificacionesModal" href="#">
            <i class="bi bi-bell"></i> Notificaciones
          </a>
        </li>
        <hr class="my-2" />
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2" href="/componentes/contacto.html">
            <i class="bi bi-envelope"></i> Cont치ctanos
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2" href="/componentes/acercaDeNosotros.html">
            <i class="bi bi-info-circle"></i> Acerca de Nosotros
          </a>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2" href="/componentes/perfil.html">
            <i class="bi bi-person-circle"></i> Perfil
          </a>
        </li>
        </li>
      </ul>
    </div>
  </div>
  <div class="container py-5">
    <div class="row g-4">
      <div class="col-lg-3 col-md-4">
        <div class="profile-card p-4">
          <div class="text-center">
            <div class="profile-img-container mb-3">
              <img src="" alt="profile-img" class="profile-img"
                id="profileImage" />
              <label for="profileImageInput" class="edit-profile-img-btn">
                <i class="bi bi-pencil-fill"></i>
              </label>
              <input type="file" id="profileImageInput" accept="image/*" style="display: none" />
            </div>
            <h1 class="h4 font-display fw-bold"></h1>
            <p class="text-muted-custom small text-center">
              Petme.
            </p>
          </div>

          <div class="mt-4">
            <h2 class="h6 font-display fw-semibold mb-3">
              Informaci칩n de Contacto
            </h2>
            <div class="d-flex flex-column gap-3">
              <div class="d-flex align-items-center gap-2">
                <span class="material-symbols-outlined text-muted-custom">mail</span>
                <span class="small">Email@example.com</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <span class="material-symbols-outlined text-muted-custom">phone</span>
                <span class="small">+1 (555) 123-4567</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <span class="material-symbols-outlined text-muted-custom">location_on</span>
                <span class="small">San Francisco, CA</span>
              </div>
            </div>
          </div>


          <div class="mt-4 d-flex flex-column gap-2">
            <button class="btn btn-primary-custom w-100" data-bs-toggle="modal" data-bs-target="#editProfileModal">
              Editar Perfil
            </button>
            <button id="logoutProfileBtn" class="btn btn-outline-danger w-100">
    <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesi칩n
  </button>

          </div>
        </div>
      </div>

      <div class="modal fade" id="notificacionesModal" tabindex="-1" aria-labelledby="notificacionesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md">
          <div class="modal-content petme-modal-content">

            <div class="modal-header petme-modal-header">
              <h5 class="modal-title" id="notificacionesModalLabel">
                <i class="bi bi-bell-fill me-2"></i> Notificaciones
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Cerrar"></button>
            </div>

            <div class="modal-body petme-modal-body" id="lista-notificaciones">
              <div class="text-center text-white-50 mt-3">Cargando...</div>
            </div>

            <div class="modal-footer petme-modal-footer justify-content-center">
              <button type="button" id="btn-marcar-todas" class="btn btn-sm btn-link petme-link text-white-50">
                Marcar todas como le칤das
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-9 col-md-8">
        <div class="profile-card">
          <ul class="nav nav-tabs px-4 pt-3 border-0">
            <li class="nav-item">
              <a class="nav-link active" href="#" id="publicacionesTab">Mis Publicaciones</a>
            </li>
          </ul>

          <div class="p-4" id="publicacionesContent">
            <div class="row g-4" id="mis-publicaciones-container">
              <div class="text-center text-muted">Cargando tus publicaciones...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title font-display fw-bold" id="editProfileModalLabel">
            Editar Perfil
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editProfileForm">
            <div class="mb-3">
              <label for="editNombre" class="form-label fw-semibold">Nombre</label>
              <input type="text" class="form-control" id="editNombre" value="Juana" required />
            </div>

            <div class="mb-3">
              <label for="editApellido" class="form-label fw-semibold">Apellido</label>
              <input type="text" class="form-control" id="editApellido" value="P칠rez" required />
            </div>

            <div class="mb-3">
              <label for="editDescription" class="form-label fw-semibold">Descripci칩n</label>
              <textarea class="form-control" id="editDescription" rows="3" required>
Amante de los perros y madre de acogida con experiencia en San Francisco.</textarea>
            </div>

            <div class="mb-3">
              <label for="editEmail" class="form-label fw-semibold">Email</label>
              <input type="email" class="form-control" id="editEmail" value="juana.perez@example.com" required />
            </div>

            <div class="mb-3">
              <label for="editPhone" class="form-label fw-semibold">Tel칠fono</label>
              <input type="tel" class="form-control" id="editPhone" value="+1 (555) 123-4567" required />
            </div>

            <div class="mb-3">
              <label for="editLocation" class="form-label fw-semibold">Ubicaci칩n</label>
              <input type="text" class="form-control" id="editLocation" value="San Francisco, CA" required />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancelar
          </button>
          <button type="button" class="btn btn-primary-custom" id="saveProfileBtn">
            Guardar Cambios
          </button>
        </div>
      </div>
    </div>
  </div>

  <div>
    <button id="chat-toggle-btn" class="btn btn-lg btn-dark-petme rounded-circle shadow-lg chat-icon-float">
      游눫
    </button>

    <div class="chat-wrapper" id="chat-wrapper">
      <div class="chat-container card shadow-lg">

        <div
          class="card-header chat-header-gradient text-white fw-bold d-flex align-items-center justify-content-between">
          <div>
            <img src="/Img/icono.png" alt="Logo Pet-Me" class="me-2"
              style="width: 25px; height: 25px; border-radius: 50%;">
            Asistente Virtual Pet-Me
          </div>
          <button id="chat-close-btn" class="btn btn-sm text-white p-0" aria-label="Cerrar chat">
            <span aria-hidden="true" style="font-size: 1.5rem;">칑</span>
          </button>
        </div>

        <div id="chat-box" class="chat-box card-body p-3">
        </div>

        <div class="chat-input-area input-group p-3 border-top">
          <input type="text" id="user-input" class="form-control" placeholder="Escribe tu mensaje o n칰mero de opci칩n...">
          <button id="send-btn" class="btn btn-dark-petme" type="button">
            <i class="bi bi-send-fill"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document
      .getElementById('saveProfileBtn')
      .addEventListener('click', function () {
        // Get form values
        const nombre = document.getElementById('editNombre').value;
        const apellido = document.getElementById('editApellido').value;
        const fullName = nombre + ' ' + apellido;
        const description = document.getElementById('editDescription').value;
        const email = document.getElementById('editEmail').value;
        const phone = document.getElementById('editPhone').value;
        const location = document.getElementById('editLocation').value;

        // Update profile display
        document.querySelector('.profile-card h1').textContent = fullName;
        document.querySelector(
          '.profile-card .text-muted-custom'
        ).textContent = description;
        document.querySelectorAll(
          '.profile-card .d-flex.align-items-center span.small'
        )[0].textContent = email;
        document.querySelectorAll(
          '.profile-card .d-flex.align-items-center span.small'
        )[1].textContent = phone;
        document.querySelectorAll(
          '.profile-card .d-flex.align-items-center span.small'
        )[2].textContent = location;

        // Close modal
        const modal = bootstrap.Modal.getInstance(
          document.getElementById('editProfileModal')
        );
        modal.hide();

        // Optional: Save to localStorage or send to backend
        const profileData = {
          nombre,
          apellido,
          description,
          email,
          phone,
          location,
        };
        localStorage.setItem('userProfile', JSON.stringify(profileData));
      });

    // Handle profile image upload
    document
      .getElementById('profileImageInput')
      .addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function (event) {
            const imageUrl = event.target.result;
            document.getElementById('profileImage').src = imageUrl;

            // Save to localStorage
            localStorage.setItem('profileImage', imageUrl);
          };
          reader.readAsDataURL(file);
        }
      });

    // Load saved profile image on page load
    window.addEventListener('DOMContentLoaded', function () {
      const savedImage = localStorage.getItem('profileImage');
      if (savedImage) {
        document.getElementById('profileImage').src = savedImage;
      }

      // --- TRUCO IMPORTANTE ---
      // Como tu archivo 'perfil.js' (que no podemos editar aqu칤) espera un clic 
      // en la pesta침a para cargar los datos, simulamos ese clic autom치ticamente
      // para que tus publicaciones aparezcan solas.
      setTimeout(() => {
        const tab = document.getElementById('publicacionesTab');
        if (tab) tab.click();
      }, 300);
    });
  </script>

  <script type="module" src="/JavaScript/notificaciones.js"></script>
  <script type="module" src="/JavaScript/perfil.js"></script>
  <script src="/JavaScript/chat.js"></script>
</body>

</html>